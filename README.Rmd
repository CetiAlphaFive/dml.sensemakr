---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# dml.sensemakr

<!-- badges: start -->
<!-- badges: end -->


## Development version

To install the development version on GitHub make sure you have the package devtools installed.

```{r, eval = FALSE}
# install.packages("devtools") 
devtools::install_github("carloscinelli/dml.sensemakr")
```



## Example

### Data
```{r example}
# loads package
library(dml.sensemakr)

## loads data
data("pension")
y <- pension$net_tfa  # net total financial assets
d <-  pension$e401    # 401K eligibility
x <- model.matrix(~ -1 + age + inc  + educ+ fsize + marr + twoearn + pira + hown, data = pension)

## compute income quartiles
g1 <- cut(x[,"inc"], quantile(x[,"inc"], c(0, 0.25,.5,.75,1), na.rm = TRUE), 
          labels = c("q1", "q2", "q3", "q4"), include.lowest = T)
```

### Fit DML
```{r}
# run DML (partially linear model)
dml.plm <- dml(y, d, x, model = "plm", groups = g1, cf.folds = 5, cf.reps = 5)
```

### Explore results
```{r}
# summary of results with median method (default)
summary(dml.plm)

# summary of results with mean method
summary(dml.plm, combine.method = "mean")
```

### extract coefs, se, confidence intervals
```{r}
# coef median method (default)
coef(dml.plm)

# coef mean method (default)
coef(dml.plm, combine.method = "mean")

# se median method (default)
se(dml.plm); 

# se median method (default)
se(dml.plm, combine.method = "mean")

# confint median method (default)
confint(dml.plm) 

# confint mean method
confint(dml.plm, combine.method = "mean")
```



### plot

```{r}
plot(dml.plm)
```

### You can add groups after the model is fit

```{r}
## compute GATE by married
g2 <- ifelse(pension$marr, "married", "not.married")

## compute GATEs
dml.g2 <- dml_gate(dml.fit = dml.plm, groups = g2)
dml.g2

summary(dml.g2)
coef(dml.g2)
confint(dml.g2)
plot(dml.g2)
```

