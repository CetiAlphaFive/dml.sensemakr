<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using Different ML Methods â€¢ dml.sensemakr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using Different ML Methods">
<meta property="og:description" content="dml.sensemakr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-158095434-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-158095434-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dml.sensemakr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using Different ML Methods</h1>
            
      
      
      <div class="hidden name"><code>other-ml-methods.Rmd</code></div>

    </div>

    
    
<p>Currently, <code>dml.sensemakr</code> uses <code>caret</code> for
handling machine learning (ML) methods. The default ML method is the
random forest implementation provided by the package
<code>ranger</code>. This is not only fast, but also seems to provide
good results with minimal to no tuning. However, researchers can use any
ML method they prefer, by just changing the <code>reg</code> argument of
the <code><a href="../reference/dml.html">dml()</a></code> function. In this vignette we provide a few
examples illustrating how to use different ML methods.</p>
<p>Here we use the same data as before: our goal is to estimate the
causal impact of 401(k) eligibility on net financial assets</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loads package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">dml.sensemakr</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## loads data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"pension"</span><span class="op">)</span></span>
<span><span class="va">y</span>  <span class="op">&lt;-</span> <span class="va">pension</span><span class="op">$</span><span class="va">net_tfa</span></span>
<span><span class="va">d</span>  <span class="op">&lt;-</span> <span class="va">pension</span><span class="op">$</span><span class="va">e401</span></span>
<span><span class="va">x</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">inc</span> <span class="op">+</span> <span class="va">educ</span><span class="op">+</span> <span class="va">fsize</span> <span class="op">+</span> <span class="va">marr</span> <span class="op">+</span> <span class="va">twoearn</span> <span class="op">+</span> <span class="va">pira</span> <span class="op">+</span> <span class="va">hown</span>, data <span class="op">=</span> <span class="va">pension</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="quick-overview">Quick Overview<a class="anchor" aria-label="anchor" href="#quick-overview"></a>
</h2>
<p>Users can provide different ML methods to <code><a href="../reference/dml.html">dml()</a></code> using
the <code>reg</code> argument. If only the name of the method is
provided, no tuning is performed, and default parameters are used. For
instance, the code below runs DML using generalized additive models
(GAMs).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generalized additive model</span></span>
<span><span class="va">dml.gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dml.html">dml</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">d</span>, <span class="va">x</span>, model <span class="op">=</span> <span class="st">"npm"</span>, reg <span class="op">=</span> <span class="st">"gam"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Target: ate </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 1 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (gam), treatment (gam)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Tuning parameters using all the data</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for D.</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   select method</span></span>
<span><span class="co">#&gt; 1   TRUE GCV.Cp</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for Y (non-parametric).</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   select method</span></span>
<span><span class="co">#&gt; 1   TRUE GCV.Cp</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; Repeating 5-fold cross-fitting 1 times</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 1 -- Folds: 1  2  3  4  5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dml.gam</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 1 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (gam, R2 = 28.292%), treatment (gam, R2 = 12.334%)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment Effect: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Estimate Std. Error t value   P(&gt;|t|)    </span></span>
<span><span class="co">#&gt; ate   7079.6     1138.4  6.2187 5.012e-10 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Note: DML estimates combined using the median method.</span></span></code></pre></div>
<p>And the code below uses gradient boosting machines (GBMs).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gradient boosting machine</span></span>
<span><span class="va">dml.gbm</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dml.html">dml</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">d</span>, <span class="va">x</span>,  model <span class="op">=</span> <span class="st">"npm"</span>, reg <span class="op">=</span> <span class="st">"gbm"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Target: ate </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 1 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (gbm), treatment (gbm)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Tuning parameters using all the data</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for D.</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   interaction.depth n.trees shrinkage n.minobsinnode</span></span>
<span><span class="co">#&gt; 1                 1      50       0.1             10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for Y (non-parametric).</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   interaction.depth n.trees shrinkage n.minobsinnode</span></span>
<span><span class="co">#&gt; 1                 1      50       0.1             10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; Repeating 5-fold cross-fitting 1 times</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 1 -- Folds: 1  2  3  4  5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dml.gbm</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 1 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (gbm, R2 = 23.154%), treatment (gbm, R2 = 11.837%)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment Effect: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Estimate Std. Error t value   P(&gt;|t|)    </span></span>
<span><span class="co">#&gt; ate   7467.8     1166.4  6.4021 1.532e-10 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Note: DML estimates combined using the median method.</span></span></code></pre></div>
<p>Above we used the same ML method for estimating both the regression
with the treatment and with the outcome. Note, however, that you can use
different methods for each regression, by specifying <code>yreg</code>
and <code>dreg</code> separately. For instance, the code below uses GAM
for the outcome regression, and GBM for the treatment regression.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gradient boosting machine</span></span>
<span><span class="va">dml.gam.gbm</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dml.html">dml</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">d</span>, <span class="va">x</span>,  model <span class="op">=</span> <span class="st">"npm"</span>, yreg <span class="op">=</span> <span class="st">"gam"</span>, dreg <span class="op">=</span> <span class="st">"gbm"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Target: ate </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 1 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (gam), treatment (gbm)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Tuning parameters using all the data</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for D.</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   interaction.depth n.trees shrinkage n.minobsinnode</span></span>
<span><span class="co">#&gt; 1                 1      50       0.1             10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for Y (non-parametric).</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   select method</span></span>
<span><span class="co">#&gt; 1   TRUE GCV.Cp</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; Repeating 5-fold cross-fitting 1 times</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 1 -- Folds: 1  2  3  4  5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dml.gam.gbm</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 1 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (gam, R2 = 27.059%), treatment (gbm, R2 = 11.778%)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment Effect: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Estimate Std. Error t value   P(&gt;|t|)    </span></span>
<span><span class="co">#&gt; ate   7676.7     1114.0  6.8912 5.533e-12 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Note: DML estimates combined using the median method.</span></span></code></pre></div>
<div class="section level3">
<h3 id="tuning-parameters">Tuning Parameters<a class="anchor" aria-label="anchor" href="#tuning-parameters"></a>
</h3>
<p>Users can provide details such as the form of cross-validation and a
specific tuning grid by passing a named list of arguments via
<code>reg</code>. The arguments of <code>reg</code> should include all
relevant arguments of the <code>train()</code> function of the package
<code>caret</code>. The main arguments are: <code>method</code>,
<code>trControl</code> and <code>tuneGrid</code> or
<code>tuneLength</code>. See <code><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">?caret::train</a></code> for further
information.</p>
<p>For instance, the code below performs 5-fold cross-validation, to
search parameters in a grid of size 5 (the values of the grid is chosen
by <code>caret</code>) for GBM.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gradient boosting machine</span></span>
<span><span class="va">gbm.args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"gbm"</span>, </span>
<span>                 trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, number <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>                 tuneLength  <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">dml.gbm</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dml.html">dml</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">d</span>, <span class="va">x</span>,  model <span class="op">=</span> <span class="st">"npm"</span>, reg <span class="op">=</span> <span class="va">gbm.args</span><span class="op">)</span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Target: ate </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 1 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (gbm), treatment (gbm)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Tuning parameters using all the data</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for D.</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;    n.trees interaction.depth shrinkage n.minobsinnode</span></span>
<span><span class="co">#&gt; 16      50                 4       0.1             10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for Y (non-parametric).</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;    n.trees interaction.depth shrinkage n.minobsinnode</span></span>
<span><span class="co">#&gt; 10     250                 2       0.1             10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; Repeating 5-fold cross-fitting 1 times</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 1 -- Folds: 1  2  3  4  5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dml.gbm</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 1 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (gbm, R2 = 26.803%), treatment (gbm, R2 = 12.135%)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment Effect: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Estimate Std. Error t value   P(&gt;|t|)    </span></span>
<span><span class="co">#&gt; ate   8175.7     1150.2  7.1083 1.175e-12 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Note: DML estimates combined using the median method.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="other-methods">Other Methods<a class="anchor" aria-label="anchor" href="#other-methods"></a>
</h2>
<p>Below we provide some templates for other machine learning methods.
In all examples you may change <code>trControl</code> to your favorite
choice of cross-validation, for instance,
<code>trControl = list(method = "cv", number = 5)</code> for 5-fold
cross validation, and also expand the parameters of the tuning grid
accordingly.</p>
<div class="section level3">
<h3 id="neural-networks">Neural Networks<a class="anchor" aria-label="anchor" href="#neural-networks"></a>
</h3>
<p>Template for using neural networks.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Neural Net</span></span>
<span><span class="va">nnet.args</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"nnet"</span>, </span>
<span>                      trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method  <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>, </span>
<span>                      tuneGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, decay <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>, </span>
<span>                      maxit <span class="op">=</span> <span class="fl">1000</span>, maxNWts <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">dml.nnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dml.html">dml</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">d</span>, <span class="va">x</span>, model <span class="op">=</span> <span class="st">"npm"</span>, reg <span class="op">=</span> <span class="va">nnet.args</span><span class="op">)</span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Target: ate </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 1 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (nnet), treatment (nnet)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Tuning parameters using all the data</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for D.</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   size decay</span></span>
<span><span class="co">#&gt; 1    8  0.01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for Y (non-parametric).</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   size decay</span></span>
<span><span class="co">#&gt; 1    8  0.01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; Repeating 5-fold cross-fitting 1 times</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 1 -- Folds: 1  2  3  4  5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dml.nnet</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 1 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (nnet, R2 = 28.732%), treatment (nnet, R2 = 11.995%)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment Effect: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Estimate Std. Error t value   P(&gt;|t|)    </span></span>
<span><span class="co">#&gt; ate   7676.8     1232.0  6.2313 4.627e-10 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Note: DML estimates combined using the median method.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lasso-with-polynomial-expansion">Lasso with Polynomial Expansion<a class="anchor" aria-label="anchor" href="#lasso-with-polynomial-expansion"></a>
</h3>
<p>Template for using lasso with a polynomial expansion of the
covariates <code>x</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># creates polynomial expansion of x</span></span>
<span><span class="va">xl</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">age</span>, <span class="fl">6</span>, raw<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">inc</span>, <span class="fl">8</span>, raw<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">educ</span>, <span class="fl">4</span>, raw<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">fsize</span>, <span class="fl">2</span>, raw<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>                      <span class="va">marr</span> <span class="op">+</span> <span class="va">twoearn</span> <span class="op">+</span> <span class="va">pira</span> <span class="op">+</span> <span class="va">hown</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, data <span class="op">=</span> <span class="va">pension</span><span class="op">)</span></span>
<span><span class="co"># lasso args</span></span>
<span><span class="va">lasso.args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"glmnet"</span>,</span>
<span>                   trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>,</span>
<span>                   tuneGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span>, lambda <span class="op">=</span> <span class="fl">0.002</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit dml</span></span>
<span><span class="va">dml.glmnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dml.html">dml</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">d</span>, <span class="va">xl</span>, model <span class="op">=</span> <span class="st">"npm"</span>, reg<span class="op">=</span> <span class="va">lasso.args</span><span class="op">)</span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Target: ate </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 1 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (glmnet), treatment (glmnet)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Tuning parameters using all the data</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for D.</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   alpha lambda</span></span>
<span><span class="co">#&gt; 1     1  0.002</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for Y (non-parametric).</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   alpha lambda</span></span>
<span><span class="co">#&gt; 1     1  0.002</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; Repeating 5-fold cross-fitting 1 times</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 1 -- Folds: 1  2  3  4  5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dml.glmnet</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 1 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (glmnet, R2 = 27.921%), treatment (glmnet, R2 = 11.98%)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment Effect: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Estimate Std. Error t value P(&gt;|t|)</span></span>
<span><span class="co">#&gt; ate   5399.6     3570.3  1.5124  0.1304</span></span>
<span><span class="co">#&gt; Note: DML estimates combined using the median method.</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://carloscinelli.com" class="external-link">Carlos Cinelli</a>, <a href="http://www.mit.edu/~vchern/" class="external-link">Victor Chernozhukov</a>, <a href="https://vsyrgkanis.com/" class="external-link">Vasilis Syrgkanis</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
