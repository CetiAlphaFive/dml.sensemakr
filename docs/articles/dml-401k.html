<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sensitivity 401k • dml.sensemakr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Sensitivity 401k">
<meta property="og:description" content="dml.sensemakr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-158095434-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-158095434-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dml.sensemakr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Sensitivity 401k</h1>
            
      
      
      <div class="hidden name"><code>dml-401k.Rmd</code></div>

    </div>

    
    
<p>Here we reproduce the empirical example of <a href="https://www.nber.org/papers/w30302" class="external-link">Chernozhukov, V., Cinelli, C.,
Newey, W., Sharma A., and Syrgkanis, V. (2021). “Long Story Short:
Omitted Variable Bias in Causal Machine Learning.”</a></p>
<div class="section level2">
<h2 id="load-data">Load Data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loads package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">dml.sensemakr</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## loads data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"pension"</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">pension</span><span class="op">$</span><span class="va">net_tfa</span> <span class="co"># net total financial assets</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">pension</span><span class="op">$</span><span class="va">e401</span> <span class="co"># 401K eligibility</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">inc</span> <span class="op">+</span> <span class="va">educ</span><span class="op">+</span> <span class="va">fsize</span> <span class="op">+</span> <span class="va">marr</span> <span class="op">+</span> <span class="va">twoearn</span> <span class="op">+</span> <span class="va">pira</span> <span class="op">+</span> <span class="va">hown</span>, data <span class="op">=</span> <span class="va">pension</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="naive-estimate-no-adjustment">Naive Estimate (no adjustment)<a class="anchor" aria-label="anchor" href="#naive-estimate-no-adjustment"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">d</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">d</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 19559.34</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="partially-linear-model">Partially Linear Model<a class="anchor" aria-label="anchor" href="#partially-linear-model"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run DML</span></span>
<span><span class="va">dml.401k.plm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dml.html">dml</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">d</span>, <span class="va">x</span>, model <span class="op">=</span> <span class="st">"plm"</span>, cf.folds <span class="op">=</span> <span class="fl">5</span>, cf.reps <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Partially Linear </span></span>
<span><span class="co">#&gt;  Target: ate </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 5 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (ranger), treatment (ranger)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Tuning parameters using all the data</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for D.</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    2             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for Y (partially linear).</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    2             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; Repeating 5-fold cross-fitting 5 times</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 1 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 2 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 3 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 4 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 5 -- Folds: 1  2  3  4  5</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># results under conditional ignorability</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dml.401k.plm</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Partially Linear </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 5 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (ranger, R2 = 27.242%), treatment (ranger, R2 = 11.517%)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment Effect: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         Estimate Std. Error t value  P(&gt;|t|)    </span></span>
<span><span class="co">#&gt; ate.all     9042       1361   6.643 3.07e-11 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Note: DML estimates combined using the median method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Verbal interpretation of DML procedure:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Average treatment effects were estimated using DML with 5-fold cross-fitting. In order to reduce the variance that stems from sample splitting, we repeated the procedure 5 times. Estimates are combined using the median as the final estimate, incorporating variation across experiments into the standard error as described in Chernozhukov et al. (2018). The outcome regression uses Random Forest from the R package ranger; the treatment regression uses Random Forest from the R package ranger.</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sensitivity analysis</span></span>
<span><span class="va">sens.401k</span> <span class="op">&lt;-</span> <span class="fu">sensemakr</span><span class="op">(</span><span class="va">dml.401k.plm</span>, cf.y <span class="op">=</span> <span class="fl">0.04</span>, cf.d <span class="op">=</span> <span class="fl">0.03</span>,<span class="op">)</span></span>
<span></span>
<span><span class="co"># summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sens.401k</span><span class="op">)</span></span>
<span><span class="co">#&gt; ==== Original Analysis ====</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Partially Linear </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 5 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (ranger, R2 = 27.242%), treatment (ranger, R2 = 11.517%)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment Effect: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         Estimate Std. Error t value  P(&gt;|t|)    </span></span>
<span><span class="co">#&gt; ate.all     9042       1361   6.643 3.07e-11 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Note: DML estimates combined using the median method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Verbal interpretation of DML procedure:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Average treatment effects were estimated using DML with 5-fold cross-fitting. In order to reduce the variance that stems from sample splitting, we repeated the procedure 5 times. Estimates are combined using the median as the final estimate, incorporating variation across experiments into the standard error as described in Chernozhukov et al. (2018). The outcome regression uses Random Forest from the R package ranger; the treatment regression uses Random Forest from the R package ranger.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ==== Sensitivity Analysis ====</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Null hypothesis: theta = 0 </span></span>
<span><span class="co">#&gt; Signif. level: alpha = 0.05 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Robustness Values:</span></span>
<span><span class="co">#&gt;         RV (%) RVa (%)</span></span>
<span><span class="co">#&gt; ate.all 7.3047  5.4621</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Verbal interpretation of robustness values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Robustness Value for the Bound (RV): omitted variables that explain more than RV% of the residual variation both of the treatment (cf.d) and of the outcome (cf.y) are sufficiently strong to make the estimated bounds include 0. Conversely, omitted variables that do not explain more than RV% of the residual variation of both the treatment and the outcome are not sufficiently strong to do so.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Robustness Value for the Confidence Bound (RVa): omitted variables that explain more than RV% of the residual variation both of the treatment (cf.d) and of the outcome (cf.y) are sufficiently strong to make the confidence bounds include 0, at the  significance level of alpha = 0.05. Conversely, omitted variables that do not explain more than RV% of the residual variation of both the treatment and the outcome are not sufficiently strong to do so.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Confidence Bounds for Sensitivity Scenario:</span></span>
<span><span class="co">#&gt;               lwr       upr</span></span>
<span><span class="co">#&gt; ate.all  2573.494 15560.906</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Confidence level: point = 95%; region = 90%.</span></span>
<span><span class="co">#&gt; Sensitivity parameters: cf.y = 0.04; cf.d = 0.03; rho2 = 1.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Verbal interpretation of confidence bounds:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- The table shows the lower (lwr) and upper (upr) limits of the confidence bounds on the target quantity, considering omitted variables with postulated sensitivity parameters cf.y, cf.d and rho2. The confidence level "point" is the relevant coverage for most use cases, and stands for the coverage rate for the true target quantity. The confidence level "region" stands for the coverage rate of the true bounds.</span></span>
<span></span>
<span><span class="co"># contour plots</span></span>
<span><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sens.401k</span>, which.bound <span class="op">=</span> <span class="st">"lwr"</span>, bound.label <span class="op">=</span> <span class="st">"Max match (3 years)"</span>, col.contour <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sens.401k</span>, which.bound <span class="op">=</span> <span class="st">"upr"</span>, bound.label <span class="op">=</span> <span class="st">"Max match (3 years)"</span>, col.contour <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="dml-401k_files/figure-html/unnamed-chunk-6-1.png" width="3600" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># benchmarks</span></span>
<span><span class="va">bench.plm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dml_benchmark.html">dml_benchmark</a></span><span class="op">(</span><span class="va">dml.401k.plm</span>, benchmark_covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"inc"</span>, <span class="st">"pira"</span>, <span class="st">"twoearn"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Computing benchmarks using covariate: inc  ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Partially Linear </span></span>
<span><span class="co">#&gt;  Target: ate </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 5 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (ranger), treatment (ranger)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Tuning parameters using all the data</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for D.</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    2             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for Y (partially linear).</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    2             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; Repeating 5-fold cross-fitting 5 times</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 1 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 2 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 3 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 4 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 5 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Computing benchmarks using covariate: pira  ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Partially Linear </span></span>
<span><span class="co">#&gt;  Target: ate </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 5 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (ranger), treatment (ranger)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Tuning parameters using all the data</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for D.</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    2             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for Y (partially linear).</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    2             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; Repeating 5-fold cross-fitting 5 times</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 1 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 2 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 3 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 4 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 5 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Computing benchmarks using covariate: twoearn  ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Partially Linear </span></span>
<span><span class="co">#&gt;  Target: ate </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 5 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (ranger), treatment (ranger)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Tuning parameters using all the data</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for D.</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    2             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for Y (partially linear).</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    2             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; Repeating 5-fold cross-fitting 5 times</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 1 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 2 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 3 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 4 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 5 -- Folds: 1  2  3  4  5</span></span>
<span><span class="va">bench.plm</span></span>
<span><span class="co">#&gt;          gain.Y   gain.D      rho theta.s theta.sj  delta</span></span>
<span><span class="co">#&gt; inc     0.14769 0.047807  0.35259    8990    12418 3428.7</span></span>
<span><span class="co">#&gt; pira    0.04655 0.005179  0.06979    8990     9101  111.4</span></span>
<span><span class="co">#&gt; twoearn 0.03641 0.005975 -0.36553    8990     8485 -504.6</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="nonparametric-model">Nonparametric Model<a class="anchor" aria-label="anchor" href="#nonparametric-model"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## compute income quartiles</span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="st">"inc"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="st">"inc"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>,<span class="fl">.5</span>,<span class="fl">.75</span>,<span class="fl">1</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"q1"</span>, <span class="st">"q2"</span>, <span class="st">"q3"</span>, <span class="st">"q4"</span><span class="op">)</span>, include.lowest <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Nonparametric model</span></span>
<span><span class="va">dml.401k.npm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dml.html">dml</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">d</span>, <span class="va">x</span>, groups <span class="op">=</span> <span class="va">g1</span>, model <span class="op">=</span> <span class="st">"npm"</span>, cf.folds <span class="op">=</span> <span class="fl">5</span>, cf.reps <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Target: ate </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 5 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (ranger), treatment (ranger)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Tuning parameters using all the data</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for D.</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    2             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for Y (non-parametric).</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    3             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; Repeating 5-fold cross-fitting 5 times</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 1 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 2 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 3 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 4 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 5 -- Folds: 1  2  3  4  5</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># results under conditional ignorability</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dml.401k.npm</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 5 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (ranger, R2 = 27.015%), treatment (ranger, R2 = 11.538%)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment Effect: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         Estimate Std. Error t value  P(&gt;|t|)    </span></span>
<span><span class="co">#&gt; ate.all     7992       1212   6.596 4.21e-11 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Group Average Treatment Effect: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         Estimate Std. Error t value  P(&gt;|t|)    </span></span>
<span><span class="co">#&gt; gate.q1   4316.3      839.2   5.144 2.69e-07 ***</span></span>
<span><span class="co">#&gt; gate.q2   2623.6     1317.8   1.991 0.046496 *  </span></span>
<span><span class="co">#&gt; gate.q3   6894.2     1843.9   3.739 0.000185 ***</span></span>
<span><span class="co">#&gt; gate.q4  18068.1     4279.1   4.222 2.42e-05 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Note: DML estimates combined using the median method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Verbal interpretation of DML procedure:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Average treatment effects were estimated using DML with 5-fold cross-fitting. In order to reduce the variance that stems from sample splitting, we repeated the procedure 5 times. Estimates are combined using the median as the final estimate, incorporating variation across experiments into the standard error as described in Chernozhukov et al. (2018). The outcome regression uses Random Forest from the R package ranger; the treatment regression uses Random Forest from the R package ranger.</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load ggplot2</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># coefficient plot under conditional ignorability</span></span>
<span><span class="va">group.names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"gate.q"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">df</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">dml.401k.npm</span><span class="op">)</span><span class="op">[</span><span class="va">group.names</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">cis</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">dml.401k.npm</span><span class="op">)</span><span class="op">[</span><span class="va">group.names</span>, <span class="op">]</span></span>
<span><span class="va">cis</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">cis</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lwr.ci"</span>, <span class="st">"upr.ci"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">cis</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">groups</span>, y <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lwr.ci</span>, ymax <span class="op">=</span> <span class="va">upr.ci</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, col <span class="op">=</span> <span class="st">"blue"</span>, fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Income Groups by Quartiles"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"ATE"</span><span class="op">)</span></span></code></pre></div>
<p><img src="dml-401k_files/figure-html/unnamed-chunk-10-1.png" width="2400" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sensitivity analysis</span></span>
<span><span class="va">sens.401k.npm</span> <span class="op">&lt;-</span> <span class="fu">sensemakr</span><span class="op">(</span><span class="va">dml.401k.npm</span>, cf.y <span class="op">=</span> <span class="fl">0.04</span>, cf.d <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sens.401k.npm</span><span class="op">)</span></span>
<span><span class="co">#&gt; ==== Original Analysis ====</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 5 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (ranger, R2 = 27.015%), treatment (ranger, R2 = 11.538%)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Treatment Effect: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         Estimate Std. Error t value  P(&gt;|t|)    </span></span>
<span><span class="co">#&gt; ate.all     7992       1212   6.596 4.21e-11 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Group Average Treatment Effect: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         Estimate Std. Error t value  P(&gt;|t|)    </span></span>
<span><span class="co">#&gt; gate.q1   4316.3      839.2   5.144 2.69e-07 ***</span></span>
<span><span class="co">#&gt; gate.q2   2623.6     1317.8   1.991 0.046496 *  </span></span>
<span><span class="co">#&gt; gate.q3   6894.2     1843.9   3.739 0.000185 ***</span></span>
<span><span class="co">#&gt; gate.q4  18068.1     4279.1   4.222 2.42e-05 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Note: DML estimates combined using the median method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Verbal interpretation of DML procedure:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Average treatment effects were estimated using DML with 5-fold cross-fitting. In order to reduce the variance that stems from sample splitting, we repeated the procedure 5 times. Estimates are combined using the median as the final estimate, incorporating variation across experiments into the standard error as described in Chernozhukov et al. (2018). The outcome regression uses Random Forest from the R package ranger; the treatment regression uses Random Forest from the R package ranger.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ==== Sensitivity Analysis ====</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Null hypothesis: theta = 0 </span></span>
<span><span class="co">#&gt; Signif. level: alpha = 0.05 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Robustness Values:</span></span>
<span><span class="co">#&gt;          RV (%) RVa (%)</span></span>
<span><span class="co">#&gt; ate.all  6.0887  4.5149</span></span>
<span><span class="co">#&gt; gate.q1 10.1360  7.0609</span></span>
<span><span class="co">#&gt; gate.q2  4.2935  0.6497</span></span>
<span><span class="co">#&gt; gate.q3  6.9704  3.6793</span></span>
<span><span class="co">#&gt; gate.q4  9.0980  5.5868</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Verbal interpretation of robustness values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Robustness Value for the Bound (RV): omitted variables that explain more than RV% of the residual variation of the outcome (cf.y) and generate an additional RV% of variation on the Riesz Representer (cf.d) are sufficiently strong to make the estimated bounds include 0. Conversely, omitted variables that do not explain more than RV% of the residual variation of the outcome nor generate an additional RV% of variation on the Riesz Representer are not sufficiently strong to do so.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Robustness Value for the Confidence Bound (RVa): omitted variables that explain more than RV% of the residual variation of the the outcome (cf.y) and generate an additional RV% of variation on the Riesz Representer (cf.d) are sufficiently strong to make the confidence bounds include 0, at the  significance level of alpha = 0.05. Conversely, omitted variables that do not explain more than RV% of the residual variation of the outcome nor generate an additional RV% of variation on the Riesz Representer are not sufficiently strong to do so. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  The interpretation of sensitivity parameters can be further refined for each target quantity. See more below.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Confidence Bounds for Sensitivity Scenario:</span></span>
<span><span class="co">#&gt;                lwr        upr</span></span>
<span><span class="co">#&gt; ate.all  1455.6475 14613.9203</span></span>
<span><span class="co">#&gt; gate.q1  1541.9920  7174.2669</span></span>
<span><span class="co">#&gt; gate.q2 -2073.1651  6651.5635</span></span>
<span><span class="co">#&gt; gate.q3   246.4833 13297.8375</span></span>
<span><span class="co">#&gt; gate.q4  4308.0514 31966.3894</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Confidence level: point = 95%; region = 90%.</span></span>
<span><span class="co">#&gt; Sensitivity parameters: cf.y = 0.04; cf.d = 0.03; rho2 = 1.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Verbal interpretation of confidence bounds:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- The table shows the lower (lwr) and upper (upr) limits of the confidence bounds on the target quantity, considering omitted variables with postulated sensitivity parameters cf.y, cf.d and rho2. The confidence level "point" is the relevant coverage for most use cases, and stands for the coverage rate for the true target quantity. The confidence level "region" stands for the coverage rate of the true bounds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Interpretation of sensitivity parameters:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- cf.y: percentage of the residual variation of the outcome explained by latent variables.</span></span>
<span><span class="co">#&gt; -- cf.d: percentage gains in the variation of the Riesz Representer generated by latent variables:</span></span>
<span><span class="co">#&gt;    ATE: cf.d measures the percentage gains in the average precision on the treatment regression.</span></span>
<span><span class="co">#&gt; -- For Group Average Treatment Effects (GATE), parameters are conditional on the relevant group.</span></span>
<span></span>
<span><span class="co"># sensitivity contour plots</span></span>
<span><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sens.401k.npm</span>, which.bound <span class="op">=</span> <span class="st">"lwr"</span>, bound.label <span class="op">=</span> <span class="st">"Max match (3 years)"</span>, col.contour <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sens.401k.npm</span>, which.bound <span class="op">=</span> <span class="st">"upr"</span>, bound.label <span class="op">=</span> <span class="st">"Max match (3 years)"</span>, col.contour <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="dml-401k_files/figure-html/unnamed-chunk-11-1.png" width="3600" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># confidence bounds plot</span></span>
<span><span class="va">bds</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dml_bounds.html">confidence_bounds</a></span><span class="op">(</span><span class="va">dml.401k.npm</span>, cf.y <span class="op">=</span> <span class="fl">0.04</span>, cf.d <span class="op">=</span> <span class="fl">0.03</span>, level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">bds</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">bds</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lwr.bound"</span>, <span class="st">"upr.bound"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cbds</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dml_bounds.html">confidence_bounds</a></span><span class="op">(</span><span class="va">dml.401k.npm</span>, cf.y <span class="op">=</span> <span class="fl">0.04</span>, cf.d <span class="op">=</span> <span class="fl">0.03</span>, level <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span></span>
<span><span class="va">cbds</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">cbds</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lwr.cbound"</span>, <span class="st">"upr.cbound"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df2</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">bds</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span>, <span class="va">cbds</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">groups</span>, y <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lwr.bound</span>, ymax <span class="op">=</span> <span class="va">upr.bound</span><span class="op">)</span>,   alpha <span class="op">=</span> <span class="fl">0.1</span>, col <span class="op">=</span> <span class="st">"red"</span>, fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lwr.cbound</span>, ymax <span class="op">=</span> <span class="va">upr.cbound</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, col <span class="op">=</span> <span class="st">"blue"</span>, fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Income Groups by Quartiles"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"ATE"</span><span class="op">)</span></span></code></pre></div>
<p><img src="dml-401k_files/figure-html/unnamed-chunk-13-1.png" width="2400" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># benchmarks</span></span>
<span><span class="va">bench.npm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dml_benchmark.html">dml_benchmark</a></span><span class="op">(</span><span class="va">dml.401k.npm</span>, benchmark_covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"inc"</span>, <span class="st">"pira"</span>, <span class="st">"twoearn"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Computing benchmarks using covariate: inc  ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Target: ate </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 5 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (ranger), treatment (ranger)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Tuning parameters using all the data</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for D.</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    2             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for Y (non-parametric).</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    2             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; Repeating 5-fold cross-fitting 5 times</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 1 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 2 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 3 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 4 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 5 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Computing benchmarks using covariate: pira  ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Target: ate </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 5 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (ranger), treatment (ranger)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Tuning parameters using all the data</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for D.</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    2             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for Y (non-parametric).</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    2             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; Repeating 5-fold cross-fitting 5 times</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 1 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 2 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 3 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 4 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 5 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Computing benchmarks using covariate: twoearn  ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Debiased Machine Learning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Model: Nonparametric </span></span>
<span><span class="co">#&gt;  Target: ate </span></span>
<span><span class="co">#&gt;  Cross-Fitting: 5 folds, 5 reps </span></span>
<span><span class="co">#&gt;  ML Method: outcome (ranger), treatment (ranger)</span></span>
<span><span class="co">#&gt;  Tuning: dirty </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Tuning parameters using all the data</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for D.</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    2             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Tuning Model for Y (non-parametric).</span></span>
<span><span class="co">#&gt; -- Best Tune:</span></span>
<span><span class="co">#&gt;   mtry min.node.size splitrule</span></span>
<span><span class="co">#&gt; 1    2             5  variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; Repeating 5-fold cross-fitting 5 times</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 1 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 2 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 3 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 4 -- Folds: 1  2  3  4  5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- Rep 5 -- Folds: 1  2  3  4  5</span></span>
<span><span class="va">bench.npm</span></span>
<span><span class="co">#&gt;          gain.Y   gain.D     rho theta.s theta.sj  delta</span></span>
<span><span class="co">#&gt; inc     0.13180 0.133750  0.2280    8061    11686 3624.9</span></span>
<span><span class="co">#&gt; pira    0.04305 0.005263  0.1002    8061     8402  341.5</span></span>
<span><span class="co">#&gt; twoearn 0.01649 0.003024 -0.4763    8061     7523 -537.6</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://carloscinelli.com" class="external-link">Carlos Cinelli</a>, <a href="http://www.mit.edu/~vchern/" class="external-link">Victor Chernozhukov</a>, <a href="https://vsyrgkanis.com/" class="external-link">Vasilis Syrgkanis</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
